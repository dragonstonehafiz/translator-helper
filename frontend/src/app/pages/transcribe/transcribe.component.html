<div class="page-container">
  <div class="header-container">
    <h1>Transcribe</h1>
    <app-tooltip-icon tooltip="Transcribe audio files to subtitle format (.ass)"></app-tooltip-icon>
  </div>

  <div class="form-section">
    <app-subsection 
      title="Transcribe Line" 
      [collapsed]="translateLineCollapsed"
      tooltip="Record audio from your microphone to transcribe into subtitle format">
      
      <div class="recording-container">
        <div class="form-group">
          <label for="inputLanguage">Input Language</label>
          <select id="inputLanguage" [(ngModel)]="inputLanguage">
            <option *ngFor="let lang of languageOptions" [value]="lang.code">{{ lang.name }} ({{ lang.code }})</option>
          </select>
        </div>

        <div class="waveform-wrapper" [class.is-recording]="isRecording">
          <canvas #waveformCanvas class="waveform-canvas"></canvas>
          <div class="waveform-overlay" *ngIf="isRecording">
            <app-loading-text-indicator text="Recording..." color="#667eea" size="1.5rem"></app-loading-text-indicator>
          </div>
        </div>
        <audio #audioPlayer [src]="recordedAudioUrl" class="audio-player" aria-hidden="true"></audio>
        
        <div class="recording-status">
          <span class="duration">
            {{ formatDuration(getDisplayCurrentTime()) }} / {{ formatDuration(getDisplayTotalTime()) }}
          </span>
        </div>

        <div class="recording-controls">
          <button 
            class="icon-btn play-btn"
            [disabled]="!recordedAudioUrl"
            (click)="togglePlayback()">
            <span class="btn-icon" aria-hidden="true">
              <svg *ngIf="!isPlaying" viewBox="0 0 24 24" role="img" focusable="false">
                <polygon points="9,7 18,12 9,17"></polygon>
              </svg>
              <svg *ngIf="isPlaying" viewBox="0 0 24 24" role="img" focusable="false">
                <rect x="7" y="7" width="4" height="10" rx="1"></rect>
                <rect x="13" y="7" width="4" height="10" rx="1"></rect>
              </svg>
            </span>
            <span class="sr-only">{{ isPlaying ? 'Pause Recording' : 'Play Recording' }}</span>
            <span class="tooltip">{{ isPlaying ? 'Pause' : 'Play' }}</span>
          </button>
          <button 
            *ngIf="!isRecording" 
            class="icon-btn record-btn" 
            (click)="startRecording()">
            <span class="btn-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" role="img" focusable="false">
                <circle cx="12" cy="12" r="6"></circle>
              </svg>
            </span>
            <span class="sr-only">Start Recording</span>
            <span class="tooltip">Start Recording</span>
          </button>
          <button 
            *ngIf="isRecording" 
            class="icon-btn stop-btn" 
            (click)="stopRecording()">
            <span class="btn-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" role="img" focusable="false">
                <rect x="8" y="8" width="8" height="8" rx="1"></rect>
              </svg>
            </span>
            <span class="sr-only">Stop Recording</span>
            <span class="tooltip">Stop Recording</span>
          </button>
          <button 
            class="icon-btn transcribe-btn"
            [disabled]="!recordedAudioUrl || isTranscribing"
            (click)="transcribeAudio()">
            <span class="btn-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" role="img" focusable="false">
                <path d="M5 6h10a2 2 0 0 1 2 2v6h-2V8H5v8h4v2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z"></path>
                <path d="M15 14h6l-2.5 3L21 20h-6l2.5-3L15 14z"></path>
              </svg>
            </span>
            <span class="sr-only">Transcribe</span>
            <span class="tooltip">{{ isTranscribing ? 'Transcribing...' : 'Transcribe' }}</span>
          </button>
        </div>

        <div class="transcript-wrapper" [class.is-loading]="isTranscribing">
          <app-text-field 
            label="Transcript" 
            placeholder="Transcript will appear here..."
            [rows]="10"
            [(ngModel)]="transcript">
          </app-text-field>
          <div class="transcript-overlay" *ngIf="isTranscribing">
            <app-loading-text-indicator text="Transcribing..." color="#667eea" size="1.4rem"></app-loading-text-indicator>
          </div>
        </div>
      </div>
      
    </app-subsection>
  </div>
</div>
